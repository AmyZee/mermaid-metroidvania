<!DOCTYPE html>
<html>
<head>
<title>Mermaid Metroidvania</title>
<meta charset="utf-8">
<style>
	body{
		margin: 0;
	}
	#game{
		width: 100%;
		height: 160vw;
		border: 1px solid black;
    		display: none;
	}
	#info{
		width: 100%;
	}
</style>
</head>
<body>
<button id="activate-acceleration" onclick="start()">Activate Acceleration</button>
<div id="info"></div>
<canvas width="1000" height="1600" id="game"></canvas>

<script>

var player = {}
	player.movement = {}
	player.movement.positionX = 450
	player.movement.positionY = 450
	player.movement.newPositionX = 0
	player.movement.newPositionY = 0
	player.movement.maxSpeed = 0.1
	player.movement.maxTiltX = 0
	player.movement.zoneRadius = 250
	
var playersprite = new Image()
	playersprite.src = "https://upload.wikimedia.org/wikipedia/commons/thumb/6/6a/Godot_icon.svg/480px-Godot_icon.svg.png"

var context = document.getElementById("game").getContext("2d")

	
function start(){

	DeviceMotionEvent.requestPermission().then(function(response){
		if (response == "granted"){
			document.getElementById("game").style.display = "block"
			window.addEventListener("deviceorientation", function(e){
				player.movement.newPositionX = player.movement.positionX + e.gamma * player.movement.maxSpeed
				player.movement.newPositionY = player.movement.positionY + e.beta * player.movement.maxSpeed
			})
		}
	})
	
	document.getElementById("game").getContext("2d").drawImage(playersprite, player.positionX - 50, player.positionY - 50, 100, 100)
	
	gameLoop()

}

function gameLoop(){

	drawMovementZone()

	playerMovement()

	window.requestAnimationFrame(gameLoop)
	
}


function drawMovementZone(){
	
	document.getElementById("game").getContext("2d").clearRect(0, 0, 1000, 1600)
	document.getElementById("game").getContext("2d").beginPath()
	document.getElementById("game").getContext("2d").arc(450, 450, player.movement.zoneRadius, 0, 2 * Math.PI)
	document.getElementById("game").getContext("2d").stroke()
	document.getElementById("game").getContext("2d").drawImage(playersprite, player.movement.positionX - 50, player.movement.positionY - 50, 100, 100)
}
	
function playerMovement(){

	limitMovement()

	player.movement.positionX = player.movement.newPositionX
	player.movement.positionY = player.movement.newPositionY
	
	document.getElementById("info").innerHTML = `positionX = ${player.movement.positionX} | positionY = ${player.movement.positionY}`
}
	
function limitMovement(){

	if(player.movement.ZoneRadius <= Math.sqrt((player.movement.newPositionX * player.movement.newPositionX) + (player.movement.positionY * player.movement.positionY))){
		return
	} else {
		var percentage = player.movement.ZoneRadius / Math.sqrt((player.movement.newPositionX * player.movement.newPositionX) + (player.movement.positionY * player.movement.positionY))
		player.movement.newPositionX = player.newPositionX * percentage
		player.movement.newPositionY = player.newPositionY * percentage
		
	}
	
}

</script>
</body>
</html>
